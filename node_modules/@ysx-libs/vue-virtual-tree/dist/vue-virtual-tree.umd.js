var Xe=Object.defineProperty;var Ye=(r,x,V)=>x in r?Xe(r,x,{enumerable:!0,configurable:!0,writable:!0,value:V}):r[x]=V;var z=(r,x,V)=>(Ye(r,typeof x!="symbol"?x+"":x,V),V);(function(r,x){typeof exports=="object"&&typeof module!="undefined"?module.exports=x(require("vue")):typeof define=="function"&&define.amd?define(["vue"],x):(r=typeof globalThis!="undefined"?globalThis:r||self,r.VueVirtualTree=x(r.Vue))})(this,function(r){"use strict";var x="";function V(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);var n=e.indexOf("Trident/");if(n>0){var i=e.indexOf("rv:");return parseInt(e.substring(i+3,e.indexOf(".",i)),10)}var s=e.indexOf("Edge/");return s>0?parseInt(e.substring(s+5,e.indexOf(".",s)),10):-1}let A;function L(){L.init||(L.init=!0,A=V()!==-1)}var R={name:"ResizeObserver",props:{emitOnMount:{type:Boolean,default:!1},ignoreWidth:{type:Boolean,default:!1},ignoreHeight:{type:Boolean,default:!1}},emits:["notify"],mounted(){L(),r.nextTick(()=>{this._w=this.$el.offsetWidth,this._h=this.$el.offsetHeight,this.emitOnMount&&this.emitSize()});const e=document.createElement("object");this._resizeObject=e,e.setAttribute("aria-hidden","true"),e.setAttribute("tabindex",-1),e.onload=this.addResizeHandlers,e.type="text/html",A&&this.$el.appendChild(e),e.data="about:blank",A||this.$el.appendChild(e)},beforeUnmount(){this.removeResizeHandlers()},methods:{compareAndNotify(){(!this.ignoreWidth&&this._w!==this.$el.offsetWidth||!this.ignoreHeight&&this._h!==this.$el.offsetHeight)&&(this._w=this.$el.offsetWidth,this._h=this.$el.offsetHeight,this.emitSize())},emitSize(){this.$emit("notify",{width:this._w,height:this._h})},addResizeHandlers(){this._resizeObject.contentDocument.defaultView.addEventListener("resize",this.compareAndNotify),this.compareAndNotify()},removeResizeHandlers(){this._resizeObject&&this._resizeObject.onload&&(!A&&this._resizeObject.contentDocument&&this._resizeObject.contentDocument.defaultView.removeEventListener("resize",this.compareAndNotify),this.$el.removeChild(this._resizeObject),this._resizeObject.onload=null,this._resizeObject=null)}}};const ce=r.withScopeId("data-v-b329ee4c");r.pushScopeId("data-v-b329ee4c");const de={class:"resize-observer",tabindex:"-1"};r.popScopeId();const ue=ce((e,t,n,i,s,o)=>(r.openBlock(),r.createBlock("div",de)));R.render=ue,R.__scopeId="data-v-b329ee4c",R.__file="src/components/ResizeObserver.vue";function D(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?D=function(t){return typeof t}:D=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},D(e)}function he(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function U(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function fe(e,t,n){return t&&U(e.prototype,t),n&&U(e,n),e}function W(e){return ye(e)||pe(e)||me(e)||ke()}function ye(e){if(Array.isArray(e))return F(e)}function pe(e){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(e))return Array.from(e)}function me(e,t){if(!!e){if(typeof e=="string")return F(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return F(e,t)}}function F(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function ke(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function be(e){var t;return typeof e=="function"?t={callback:e}:t=e,t}function ge(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i,s,o,l=function(c){for(var b=arguments.length,g=new Array(b>1?b-1:0),f=1;f<b;f++)g[f-1]=arguments[f];if(o=g,!(i&&c===s)){var y=n.leading;typeof y=="function"&&(y=y(c,s)),(!i||c!==s)&&y&&e.apply(void 0,[c].concat(W(o))),s=c,clearTimeout(i),i=setTimeout(function(){e.apply(void 0,[c].concat(W(o))),i=0},t)}};return l._clear=function(){clearTimeout(i),i=null},l}function G(e,t){if(e===t)return!0;if(D(e)==="object"){for(var n in e)if(!G(e[n],t[n]))return!1;return!0}return!1}var ve=function(){function e(t,n,i){he(this,e),this.el=t,this.observer=null,this.frozen=!1,this.createObserver(n,i)}return fe(e,[{key:"createObserver",value:function(n,i){var s=this;if(this.observer&&this.destroyObserver(),!this.frozen){if(this.options=be(n),this.callback=function(a,c){s.options.callback(a,c),a&&s.options.once&&(s.frozen=!0,s.destroyObserver())},this.callback&&this.options.throttle){var o=this.options.throttleOptions||{},l=o.leading;this.callback=ge(this.callback,this.options.throttle,{leading:function(c){return l==="both"||l==="visible"&&c||l==="hidden"&&!c}})}this.oldResult=void 0,this.observer=new IntersectionObserver(function(a){var c=a[0];if(a.length>1){var b=a.find(function(f){return f.isIntersecting});b&&(c=b)}if(s.callback){var g=c.isIntersecting&&c.intersectionRatio>=s.threshold;if(g===s.oldResult)return;s.oldResult=g,s.callback(g,c)}},this.options.intersection),r.nextTick(function(){s.observer&&s.observer.observe(s.el)})}}},{key:"destroyObserver",value:function(){this.observer&&(this.observer.disconnect(),this.observer=null),this.callback&&this.callback._clear&&(this.callback._clear(),this.callback=null)}},{key:"threshold",get:function(){return this.options.intersection&&typeof this.options.intersection.threshold=="number"?this.options.intersection.threshold:0}}]),e}();function X(e,t,n){var i=t.value;if(!!i)if(typeof IntersectionObserver=="undefined")console.warn("[vue-observe-visibility] IntersectionObserver API is not available in your browser. Please install this polyfill: https://github.com/w3c/IntersectionObserver/tree/master/polyfill");else{var s=new ve(e,i,n);e._vue_visibilityState=s}}function we(e,t,n){var i=t.value,s=t.oldValue;if(!G(i,s)){var o=e._vue_visibilityState;if(!i){Y(e);return}o?o.createObserver(i,n):X(e,{value:i},n)}}function Y(e){var t=e._vue_visibilityState;t&&(t.destroyObserver(),delete e._vue_visibilityState)}var Se={beforeMount:X,updated:we,unmounted:Y},Ce={itemsLimit:1e3},xe=/(auto|scroll)/;function J(e,t){return e.parentNode===null?t:J(e.parentNode,t.concat([e]))}var M=function(t,n){return getComputedStyle(t,null).getPropertyValue(n)},_e=function(t){return M(t,"overflow")+M(t,"overflow-y")+M(t,"overflow-x")},ze=function(t){return xe.test(_e(t))};function $e(e){if(e instanceof HTMLElement||e instanceof SVGElement){for(var t=J(e.parentNode,[]),n=0;n<t.length;n+=1)if(ze(t[n]))return t[n];return document.scrollingElement||document.documentElement}}function j(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?j=function(t){return typeof t}:j=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j(e)}var Ie={items:{type:Array,required:!0},keyField:{type:String,default:"id"},direction:{type:String,default:"vertical",validator:function(t){return["vertical","horizontal"].includes(t)}}};function Ke(){return this.items.length&&j(this.items[0])!=="object"}var P=!1;if(typeof window!="undefined"){P=!1;try{var Ve=Object.defineProperty({},"passive",{get:function(){P=!0}});window.addEventListener("test",null,Ve)}catch{}}let Ne=0;var H={name:"RecycleScroller",components:{ResizeObserver:R},directives:{ObserveVisibility:Se},props:{...Ie,itemSize:{type:Number,default:null},minItemSize:{type:[Number,String],default:null},sizeField:{type:String,default:"size"},typeField:{type:String,default:"type"},buffer:{type:Number,default:200},pageMode:{type:Boolean,default:!1},prerender:{type:Number,default:0},emitUpdate:{type:Boolean,default:!1}},emits:["resize","visible","hidden","update"],data(){return{pool:[],totalSize:0,ready:!1,hoverKey:null}},computed:{sizes(){if(this.itemSize===null){const e={"-1":{accumulator:0}},t=this.items,n=this.sizeField,i=this.minItemSize;let s=1e4,o=0,l;for(let a=0,c=t.length;a<c;a++)l=t[a][n]||i,l<s&&(s=l),o+=l,e[a]={accumulator:o,size:l};return this.$_computedMinItemSize=s,e}return[]},simpleArray:Ke},watch:{items(){this.updateVisibleItems(!0)},pageMode(){this.applyPageMode(),this.updateVisibleItems(!1)},sizes:{handler(){this.updateVisibleItems(!1)},deep:!0}},created(){this.$_startIndex=0,this.$_endIndex=0,this.$_views=new Map,this.$_unusedViews=new Map,this.$_scrollDirty=!1,this.$_lastUpdateScrollPosition=0,this.prerender&&(this.$_prerender=!0,this.updateVisibleItems(!1))},mounted(){this.applyPageMode(),this.$nextTick(()=>{this.$_prerender=!1,this.updateVisibleItems(!0),this.ready=!0})},beforeUnmount(){this.removeListeners()},methods:{addView(e,t,n,i,s){const o=r.markRaw({id:Ne++,index:t,used:!0,key:i,type:s}),l=r.shallowReactive({item:n,position:0,nr:o});return e.push(l),l},unuseView(e,t=!1){const n=this.$_unusedViews,i=e.nr.type;let s=n.get(i);s||(s=[],n.set(i,s)),s.push(e),t||(e.nr.used=!1,e.position=-9999,this.$_views.delete(e.nr.key))},handleResize(){this.$emit("resize"),this.ready&&this.updateVisibleItems(!1)},handleScroll(e){this.$_scrollDirty||(this.$_scrollDirty=!0,requestAnimationFrame(()=>{this.$_scrollDirty=!1;const{continuous:t}=this.updateVisibleItems(!1,!0);t||(clearTimeout(this.$_refreshTimout),this.$_refreshTimout=setTimeout(this.handleScroll,100))}))},handleVisibilityChange(e,t){this.ready&&(e||t.boundingClientRect.width!==0||t.boundingClientRect.height!==0?(this.$emit("visible"),requestAnimationFrame(()=>{this.updateVisibleItems(!1)})):this.$emit("hidden"))},updateVisibleItems(e,t=!1){const n=this.itemSize,i=this.$_computedMinItemSize,s=this.typeField,o=this.simpleArray?null:this.keyField,l=this.items,a=l.length,c=this.sizes,b=this.$_views,g=this.$_unusedViews,f=this.pool;let y,k,N;if(!a)y=k=N=0;else if(this.$_prerender)y=0,k=this.prerender,N=null;else{const p=this.getScroll();if(t){let C=p.start-this.$_lastUpdateScrollPosition;if(C<0&&(C=-C),n===null&&C<i||C<n)return{continuous:!0}}this.$_lastUpdateScrollPosition=p.start;const w=this.buffer;if(p.start-=w,p.end+=w,n===null){let C,d=0,m=a-1,h=~~(a/2),v;do v=h,C=c[h].accumulator,C<p.start?d=h:h<a-1&&c[h+1].accumulator>p.start&&(m=h),h=~~((d+m)/2);while(h!==v);for(h<0&&(h=0),y=h,N=c[a-1].accumulator,k=h;k<a&&c[k].accumulator<p.end;k++);k===-1?k=l.length-1:(k++,k>a&&(k=a))}else y=~~(p.start/n),k=Math.ceil(p.end/n),y<0&&(y=0),k>a&&(k=a),N=a*n}k-y>Ce.itemsLimit&&this.itemsLimitError(),this.totalSize=N;let u;const K=y<=this.$_endIndex&&k>=this.$_startIndex;if(this.$_continuous!==K){if(K){b.clear(),g.clear();for(let p=0,w=f.length;p<w;p++)u=f[p],this.unuseView(u)}this.$_continuous=K}else if(K)for(let p=0,w=f.length;p<w;p++)u=f[p],u.nr.used&&(e&&(u.nr.index=l.findIndex(C=>o?C[o]===u.item[o]:C===u.item)),(u.nr.index===-1||u.nr.index<y||u.nr.index>=k)&&this.unuseView(u));const $=K?null:new Map;let S,_,I,T;for(let p=y;p<k;p++){S=l[p];const w=o?S[o]:S;if(w==null)throw new Error(`Key is ${w} on item (keyField is '${o}')`);if(u=b.get(w),!n&&!c[p].size){u&&this.unuseView(u);continue}u?(u.nr.used=!0,u.item=S):(_=S[s],I=g.get(_),K?I&&I.length?(u=I.pop(),u.item=S,u.nr.used=!0,u.nr.index=p,u.nr.key=w,u.nr.type=_):u=this.addView(f,p,S,w,_):(T=$.get(_)||0,(!I||T>=I.length)&&(u=this.addView(f,p,S,w,_),this.unuseView(u,!0),I=g.get(_)),u=I[T],u.item=S,u.nr.used=!0,u.nr.index=p,u.nr.key=w,u.nr.type=_,$.set(_,T+1),T++),b.set(w,u)),n===null?u.position=c[p-1].accumulator:u.position=p*n}return this.$_startIndex=y,this.$_endIndex=k,this.emitUpdate&&this.$emit("update",y,k),clearTimeout(this.$_sortTimer),this.$_sortTimer=setTimeout(this.sortViews,300),{continuous:K}},getListenerTarget(){let e=$e(this.$el);return window.document&&(e===window.document.documentElement||e===window.document.body)&&(e=window),e},getScroll(){const{$el:e,direction:t}=this,n=t==="vertical";let i;if(this.pageMode){const s=e.getBoundingClientRect(),o=n?s.height:s.width;let l=-(n?s.top:s.left),a=n?window.innerHeight:window.innerWidth;l<0&&(a+=l,l=0),l+a>o&&(a=o-l),i={start:l,end:l+a}}else n?i={start:e.scrollTop,end:e.scrollTop+e.clientHeight}:i={start:e.scrollLeft,end:e.scrollLeft+e.clientWidth};return i},applyPageMode(){this.pageMode?this.addListeners():this.removeListeners()},addListeners(){this.listenerTarget=this.getListenerTarget(),this.listenerTarget.addEventListener("scroll",this.handleScroll,P?{passive:!0}:!1),this.listenerTarget.addEventListener("resize",this.handleResize)},removeListeners(){!this.listenerTarget||(this.listenerTarget.removeEventListener("scroll",this.handleScroll),this.listenerTarget.removeEventListener("resize",this.handleResize),this.listenerTarget=null)},scrollToItem(e){let t;this.itemSize===null?t=e>0?this.sizes[e-1].accumulator:0:t=e*this.itemSize,this.scrollToPosition(t)},scrollToPosition(e){this.direction==="vertical"?this.$el.scrollTop=e:this.$el.scrollLeft=e},itemsLimitError(){throw setTimeout(()=>{console.log("It seems the scroller element isn't scrolling, so it tries to render all the items at once.","Scroller:",this.$el),console.log("Make sure the scroller has a fixed height (or width) and 'overflow-y' (or 'overflow-x') set to 'auto' so it can scroll correctly and only render the items visible in the scroll viewport.")}),new Error("Rendered items limit reached")},sortViews(){this.pool.sort((e,t)=>e.index-t.index)}}};const Te={key:0,class:"vue-recycle-scroller__slot"},Oe={key:1,class:"vue-recycle-scroller__slot"};function Ee(e,t,n,i,s,o){const l=r.resolveComponent("ResizeObserver"),a=r.resolveDirective("observe-visibility");return r.withDirectives((r.openBlock(),r.createBlock("div",{class:["vue-recycle-scroller",{ready:s.ready,"page-mode":n.pageMode,[`direction-${e.direction}`]:!0}],onScrollPassive:t[2]||(t[2]=(...c)=>o.handleScroll&&o.handleScroll(...c))},[e.$slots.before?(r.openBlock(),r.createBlock("div",Te,[r.renderSlot(e.$slots,"before")])):r.createCommentVNode("v-if",!0),r.createVNode("div",{ref:"wrapper",style:{[e.direction==="vertical"?"minHeight":"minWidth"]:s.totalSize+"px"},class:"vue-recycle-scroller__item-wrapper"},[(r.openBlock(!0),r.createBlock(r.Fragment,null,r.renderList(s.pool,c=>(r.openBlock(),r.createBlock("div",{key:c.nr.id,style:s.ready?{transform:`translate${e.direction==="vertical"?"Y":"X"}(${c.position}px)`}:null,class:["vue-recycle-scroller__item-view",{hover:s.hoverKey===c.nr.key}],onMouseenter:b=>s.hoverKey=c.nr.key,onMouseleave:t[1]||(t[1]=b=>s.hoverKey=null)},[r.renderSlot(e.$slots,"default",{item:c.item,index:c.nr.index,active:c.nr.used})],46,["onMouseenter"]))),128))],4),e.$slots.after?(r.openBlock(),r.createBlock("div",Oe,[r.renderSlot(e.$slots,"after")])):r.createCommentVNode("v-if",!0),r.createVNode(l,{onNotify:o.handleResize},null,8,["onNotify"])],34)),[[a,o.handleVisibilityChange]])}H.render=Ee,H.__file="src/components/RecycleScroller.vue";class Q{constructor(t,n){z(this,"key");z(this,"name");z(this,"level");z(this,"loading",!1);z(this,"hasChildren",!1);z(this,"showCheckbox");z(this,"children",[]);z(this,"parentKey");z(this,"parentKeys",[]);z(this,"origin");this.key=t.nodeKey,this.name=t.name,this.showCheckbox=t.showCheckbox,this.parentKey=n==null?void 0:n.key,this.parentKeys=n?[...n.parentKeys,n.key]:[],this.level=n?n.level+1:0,this.origin=r.toRaw(t)}}function Be(e){const t=Z(e),n=ee(t),i=te(n);return{treeData:t,flattenTreeData:n,key2TreeNode:i}}function Z(e,t){const n=(i,s)=>i.map(o=>{var a;const l=o instanceof Q?o:new Q(o,s);return l.children=(a=o.children)!=null&&a.length?n(o.children,l):[],l.hasChildren=o.hasChildren||l.children.length>0,l});return n(e,t)}function ee(e){const t=[];function n(i){i.forEach(s=>{t.push(s),n(s.children)})}return n(e),t}function te(e){const t={};return e.forEach(n=>{t[n.key]=n}),t}const Ae=r.createElementVNode("div",{class:"inner"},null,-1),Re={class:"content"},De=r.defineComponent({props:{modelValue:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},halfChecked:{type:Boolean,default:!1}},emits:["change","update:modelValue"],setup(e,{emit:t}){const n=e,i=r.computed(()=>{let o="vir-checkbox";return n.modelValue?o+=" checked":n.halfChecked&&(o+=" half-checked"),n.disabled&&(o+=" disabled"),o}),s=o=>{o.stopPropagation(),n.disabled||(t("update:modelValue",!n.modelValue),t("change",!n.modelValue))};return(o,l)=>(r.openBlock(),r.createElementBlock("div",{class:r.normalizeClass(r.unref(i)),onClick:s},[Ae,r.createElementVNode("div",Re,[r.renderSlot(o.$slots,"default")])],2))}});var ne=r.defineComponent({name:"RenderNode",props:{titleCls:String,node:{type:Object,required:!0},context:{type:Object,required:!0}},setup(e){const{context:t,node:n,titleCls:i}=r.toRefs(e);return()=>t.value.renderNode?t.value.renderNode(n.value):t.value.slots.node?r.renderSlot(t.value.slots,"node",{node:n.value}):r.createVNode("span",{class:i.value},[n.value.name])}}),je=r.defineComponent({name:"RenderIcon",props:{node:{type:Object,required:!0},context:{type:Object,required:!0}},setup({context:e,node:t}){const{loading:n,key:i}=r.toRefs(t),{expandedKeys:s,renderIcon:o,slots:l}=e,a=r.computed(()=>s.has(i.value));return()=>o?o({node:t,loading:n.value,expanded:a.value}):l.icon?r.renderSlot(l,"icon",{node:t,loading:n.value,expanded:a.value}):r.createVNode("div",{class:"def-arrow"},[n.value?r.createVNode("i",{class:"iconfont iconloading ico-loading"},null):r.createVNode("i",{class:"iconfont iconExpand"},null)])}});const re=Symbol("TreeInjectionKey"),Le=r.defineComponent({name:"TreeNode"}),ie=r.defineComponent({...Le,props:{node:{type:Object,required:!0},selectedKeys:{type:Object,required:!0},focusKey:{type:[String,Number]},expandedKeys:{type:Object,required:!0},disabledKeys:{type:Object,required:!0},checkedKeys:{type:Set,required:!0},halfCheckedKeys:{type:Set,required:!0},showCheckbox:{type:Boolean,default:!1}},emits:["selectChange","checkChange","toggleExpand"],setup(e,{emit:t}){const n=e,i=r.computed(()=>n.node.hasChildren),s=r.computed(()=>n.node.showCheckbox!==void 0?n.node.showCheckbox:n.showCheckbox),o=r.inject(re),l=r.computed(()=>({"--vir-tree-level":n.node.level})),a=r.computed(()=>{let y="node-title";return n.focusKey===n.node.key&&(y+=" focused"),n.selectedKeys.has(n.node.key)&&(y+=" selected"),n.disabledKeys.has(n.node.key)&&(y+=" disabled"),y}),c=y=>{y.stopPropagation(),n.disabledKeys.has(n.node.key)||t("selectChange",n.node)},b=()=>{t("checkChange",n.node)},g=()=>{i&&t("toggleExpand",{state:!o.expandedKeys.has(n.node.key),node:n.node})},f=y=>{y.stopPropagation(),g()};return(y,k)=>(r.openBlock(),r.createElementBlock("div",{class:"vir-tree-node",style:r.normalizeStyle(r.unref(l)),onClick:g},[r.createElementVNode("div",{onClick:f,class:r.normalizeClass(["node-arrow",n.expandedKeys.has(n.node.key)?"expanded":""])},[r.unref(i)?(r.openBlock(),r.createBlock(r.unref(je),{key:0,context:r.unref(o),node:n.node},null,8,["context","node"])):r.createCommentVNode("",!0)],2),r.unref(s)?(r.openBlock(),r.createBlock(De,{key:0,class:"node-content node-check-box",disabled:n.disabledKeys.has(n.node.key),modelValue:n.checkedKeys.has(n.node.key),halfChecked:n.halfCheckedKeys.has(n.node.key),onChange:b},{default:r.withCtx(()=>[r.createVNode(r.unref(ne),{"title-cls":r.unref(a),context:r.unref(o),node:n.node},null,8,["title-cls","context","node"])]),_:1},8,["disabled","modelValue","halfChecked"])):(r.openBlock(),r.createElementBlock("div",{key:1,class:"node-content node-text",onClick:c},[r.createVNode(r.unref(ne),{"title-cls":r.unref(a),context:r.unref(o),node:n.node},null,8,["title-cls","context","node"])]))],4))}});function E(e){return e?"add":"delete"}function se(e,{checkedKeys:t,halfCheckedKeys:n,checkStrictly:i,key2TreeNode:s}){t.clear(),n.clear(),e.forEach(o=>{if(!t.has(o)){const l=s[o];l?oe({node:l,checked:!0,checkedKeys:t,halfCheckedKeys:n,key2TreeNode:s,checkStrictly:i}):t.add(o)}})}function oe(e){const{node:t,checked:n,checkedKeys:i,halfCheckedKeys:s,key2TreeNode:o,checkStrictly:l}=e;i[E(n)](t.key),s.delete(t.key),l||(Fe({node:t,checked:n,checkedKeys:i,halfCheckedKeys:s}),Me({node:t,key2TreeNode:o,checkedKeys:i,halfCheckedKeys:s}))}function Fe(e){const{node:t,checked:n,checkedKeys:i,halfCheckedKeys:s}=e,o=E(n),l=a=>{a.length&&a.forEach(c=>{var b;i[o](c.key),s.delete(c.key),(b=c.children)!=null&&b.length&&l(c.children)})};l(t.children)}function Me(e){const{node:t,checkedKeys:n,halfCheckedKeys:i,key2TreeNode:s}=e,o=l=>{if(l.parentKey){const a=s[l.parentKey],{key:c,children:b}=a,{checked:g,indeterminate:f}=Pe({nodes:b,checkedKeys:n,halfCheckedKeys:i});(g!==n.has(c)||f!==i.has(c))&&(n[E(g)](c),i[E(f)](c),o(a))}};o(t)}function Pe(e){const{nodes:t,checkedKeys:n,halfCheckedKeys:i}=e;let s=0,o=!1;for(let a=0;a<t.length;a++){const c=t[a],b=n.has(c.key),g=i.has(c.key);if(b&&s++,g||!b&&s>0){o=!0;break}}const l=s===t.length;return{checked:l,indeterminate:o||!l&&s>0}}const He={key:1,class:"vir-tree-wrap"},le=r.defineComponent({props:{source:{type:Array,default:[]},defaultSelectedKey:{type:[String,Number],default:""},defaultExpandedKeys:{type:Array,default:[]},defaultCheckedKeys:{type:Array,default:[]},defaultDisabledKeys:{type:Array,default:[]},showCheckbox:{type:Boolean,default:!1},checkStrictly:{type:Boolean,default:!1},renderNode:Function,renderIcon:Function,loadData:Function,virtual:Object},emits:["selectChange","checkChange","expandChange","focusChange","keydown"],setup(e,{expose:t,emit:n}){const i=e,s=r.ref([]),o=r.ref({});r.watch(()=>i.source,d=>{const m=Be(d);s.value=m.flattenTreeData,o.value=m.key2TreeNode},{immediate:!0});const l=r.ref(new Set);r.watch(()=>i.defaultDisabledKeys,d=>{l.value.clear(),l.value=new Set(d)},{immediate:!0});const a=r.ref(new Set),c=r.ref(new Set);r.watch(()=>i.defaultCheckedKeys,d=>{se(d,{checkedKeys:a.value,halfCheckedKeys:c.value,checkStrictly:i.checkStrictly,key2TreeNode:o.value})},{immediate:!0}),r.watchEffect(()=>{});const b=r.computed(()=>s.value.filter(d=>{const m=!d.parentKey,h=d.parentKeys.every(v=>f.value.has(v));return m||h})),g=r.computed(()=>i.virtual&&+(i.virtual.size*i.virtual.remain)||0),f=r.ref(new Set);r.watch(()=>i.defaultExpandedKeys,d=>{f.value.clear(),f.value=new Set(d)},{immediate:!0});const y=r.ref(!1);function k({state:d,node:m,source:h}){y.value||(f.value[E(d)](m.key),d&&!m.children.length&&i.loadData&&(m.loading=!0,y.value=!0,i.loadData(m,v=>{m.loading=!1,y.value=!1,v.length?(N(m,v),se([...a.value],{checkedKeys:a.value,halfCheckedKeys:c.value,checkStrictly:i.checkStrictly,key2TreeNode:o.value})):(m.children=[],m.hasChildren=!1)})),n("expandChange",{state:d,node:m,source:h||"click"}))}function N(d,m){const h=s.value.findIndex(O=>O.key===d.key),v=Z(m,d);d.children=v;const B=ee(v);s.value.splice(h+1,0,...B);const q=te(B);Object.assign(o.value,q),B.forEach(async O=>{f.value.has(O.key)&&(await r.nextTick(),k({state:!0,node:O}))})}const u=r.ref(new Set);r.watch(()=>i.defaultSelectedKey,d=>{u.value.clear(),u.value.add(d)},{immediate:!0});const K=r.computed(()=>o.value[Array.from(u.value.values())[0]]),$=r.ref();function S(d){!d||($.value=d.key,n("focusChange",{node:d}))}function _(){$.value=void 0,n("focusChange",{node:null})}function I(){var d;$.value||S((d=s.value)==null?void 0:d.at(0))}function T(d){const{key:m}=d;if(!$.value)return;const h=o.value[$.value],v=(O,Ue)=>{var ae;if(!O)return;const We=b.value.findIndex(({key:Ge})=>Ge===O.key);return(ae=b.value)==null?void 0:ae[We+Ue]},B=()=>{d.stopPropagation(),d.preventDefault(),h.hasChildren&&(f.value.has(h.key)?S(v(h,1)):k({node:h,state:!0,source:"key"}))},q=()=>{d.stopPropagation(),d.preventDefault(),f.value.has(h.key)?k({node:h,state:!1,source:"key"}):h.parentKey&&S(o.value[h.parentKey])};switch(m){case"ArrowUp":d.preventDefault(),S(v(h,-1));break;case"ArrowDown":d.preventDefault(),S(v(h,1));break;case"ArrowLeft":d.preventDefault(),q();break;case"ArrowRight":d.preventDefault(),B();break}n("keydown",{event:d,node:h})}function p(d){const m=o.value[Array.from(u.value.values())[0]];let h;u.value.has(d.key)?u.value.clear():(u.value.clear(),u.value.add(d.key),h=d),n("selectChange",{preSelectedNode:m,node:h})}function w(d){const m=!a.value.has(d.key);oe({node:d,checked:m,checkedKeys:a.value,halfCheckedKeys:c.value,key2TreeNode:o.value,checkStrictly:i.checkStrictly}),n("checkChange",{state:m,node:d})}const C=r.shallowReactive({renderNode:i.renderNode,renderIcon:i.renderIcon,slots:r.useSlots(),expandedKeys:f.value,getExpandedKeys:()=>[...f.value],getSelectedNode:()=>K.value,getCheckedNodes:()=>Array.from(a.value).map(d=>o.value[d]).filter(Boolean),getHalfCheckedNodes:()=>Array.from(c.value).map(d=>o.value[d]),toggleExpand:(d,m)=>k({state:m!=null?m:!f.value.has(d),node:o.value[d],source:"api"})});return t(r.toRaw(C)),r.provide(re,C),(d,m)=>{var h;return r.openBlock(),r.createElementBlock("div",{class:"vir-tree",tabindex:"0",onKeydown:T,onFocusin:I,onFocusout:_},[r.unref(g)?(r.openBlock(),r.createBlock(r.unref(H),{key:0,class:"vir-tree-wrap",style:r.normalizeStyle({height:r.unref(g)+"px"}),items:r.unref(b),"item-size":(h=i.virtual)==null?void 0:h.size,"key-field":"key"},{default:r.withCtx(({item:v})=>[(r.openBlock(),r.createBlock(ie,{node:v,key:v.key,"show-checkbox":e.showCheckbox,"selected-keys":u.value,"disabled-keys":l.value,"expanded-keys":f.value,"checked-keys":a.value,"focus-key":$.value,"half-checked-keys":c.value,onToggleExpand:k,onSelectChange:p,onCheckChange:w},null,8,["node","show-checkbox","selected-keys","disabled-keys","expanded-keys","checked-keys","focus-key","half-checked-keys"]))]),_:1},8,["style","items","item-size"])):(r.openBlock(),r.createElementBlock("div",He,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(r.unref(b),v=>(r.openBlock(),r.createBlock(ie,{key:v.key,node:v,"show-checkbox":e.showCheckbox,"selected-keys":u.value,"disabled-keys":l.value,"expanded-keys":f.value,"focus-key":$.value,"checked-keys":a.value,"half-checked-keys":c.value,onToggleExpand:k,onSelectChange:p,onCheckChange:w},null,8,["node","show-checkbox","selected-keys","disabled-keys","expanded-keys","focus-key","checked-keys","half-checked-keys"]))),128))]))],32)}}});var qe=Object.assign(le,{install:e=>{e.component("VirTree",le)}});return qe});
